<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8" />
    <title>Browser App</title>
    <link rel="stylesheet" href="GerichtAuswahl.css">
    <link rel="stylesheet" href="style.css">
    <script src="database.js"></script>
    <script src="./GerichtAuswahl.js"></script>

    <script type="text/javascript">
        let pages = [{
            url: "/GerichtAuswahl",
            resource: "/GerichtAuswahl/GerichtAuswahl.html",
            klasse: GerichtAuswahl
        }, ];
        window.addEventListener("load", function() {
            let app = new App();
            app.run()
        });
    </script>
</head>

<body>
    <div class="topnav">
<<<<<<< HEAD
        <a href="index.html">Bilanz</a>
        <a class="active" href="GerichtAuswahl.html">Gericht eintragen</a>
        <a href="KalorienRechner.html">Täglicher Kalorienbedarf</a>
=======
        <a href="#home">Bilanz</a>
        <a class="active" href="#food">Gericht eintragen</a>
        <a href="#calories">Täglicher Kalorienbedarf</a>
>>>>>>> 05b5462bc5c84204b9ae8699f6857c2d07fa709a
    </div>

    <h1>Gericht auswählen</h1>
    <p>Bitte Wählen Sie ein Gericht aus. Sollte Ihr Gericht nicht vorhanden sein, so können Sie es hinzufügen.</p>

    <html>

    <head>
        <title>BrowserApp</title>
        <meta charset="utf-8" />

        <script src="database.js"></script>

        <!-- Google Firebase -->
        <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-firestore.js"></script>

        <!-- Tabulator Tabelle -->
        <link rel="stylesheet" href="GerichtAuswahl.css">
        <script src="https://unpkg.com/tabulator-tables@4.4.3/dist/js/tabulator.min.js"></script>

        <script>
            window.addEventListener("load", async () => {
                let buttonInsertRow = document.getElementById("button-insert-row");
                let buttonDeleteRows = document.getElementById("button-delete-rows");
                let buttonDiscardChanges = document.getElementById("button-discard-changes");
                let buttonSaveChanges = document.getElementById("button-save-changes");
                let table = new Tabulator("#tabelle", {
                    layout: "fitColumns",
                    columns: [
                        // Markierspalte
                        {
                            formatter: "rowSelection",
                            titleFormatter: "rowSelection",
                            headerSort: false,
                            width: 20
                        },
                        // Datenspalten
                        {
                            title: "Gericht",
                            field: "gericht",
                            editor: "input"
                        },
                        {
                            title: "Kcal",
                            field: "kcal",
                            editor: "input"
                        },
                    ],
                });
                let database = new Database();
                await database.createDemoData();
                let deletedGerichte = [];
                async function insertRow() {
                    table.addData([{
                        gericht: "",
                        kcal: "",
                    }]);
                }
                async function deleteRows() {
                    let gerichte = table.getSelectedData();
                    let rows = table.getSelectedRows();
                    gerichte.forEach(gericht => {
                        deletedGerichte.push(gericht.gericht);
                    });
                    rows.forEach(row => {
                        row.delete();
                    });
                }
                // lädt Daten
                async function reloadData() {
                    deletedGerichte = [];
                    let gerichte = await database.selectAllGerichte();
                    table.replaceData(gerichte);
                }
                // speichert Daten
                async function saveChanges() {
                    try {
                        await database.deleteGerichteById(deletedGerichte);
                        await database.saveGerichte(table.getData());
                        displayMessage("success", "Änderungen wurden gespeichert.");
                        reloadData();
                    } catch (error) {
                        displayMessage("danger", `<strong>Fehler beim speichern:</strong> ${error}`);
                    }
                }
                // gibt Message aus
                function displayMessage(type, message) {
                    console.log(type, message);
                    let divElement = document.createElement("div");
                    divElement.className = `alert alert-${type} alert-dismissible fade show`;
                    divElement.setAttribute("role", "alert");
                    divElement.innerHTML = `
                        ${message}
                    `;
                    document.getElementById("alerts").appendChild(divElement);
                    setTimeout(() => $(divElement).alert("close"), 5000);
                }
                // die dazugehörigen Button
                buttonInsertRow.addEventListener("click", insertRow);
                buttonDeleteRows.addEventListener("click", deleteRows);
                buttonDiscardChanges.addEventListener("click", reloadData);
                buttonSaveChanges.addEventListener("click", saveChanges);
                reloadData();
            });


            // Ermöglicht das Durchsuchen der Tabelle nach Gerichten
            function Search() {
                // Declare variables
                var input, filter, table, tr, td, i, txtValue;
                input = document.getElementById("Search");
                filter = input.value.toUpperCase();
                table = document.getElementById("table");
                tr = table.getElementsByTagName("tr");
                // Loop through all table rows, and hide those who don't match the search query
                for (i = 0; i < tr.length; i++) {
                    td = tr[i].getElementsByTagName("td")[0];
                    if (td) {
                        txtValue = td.textContent || td.innerText;
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            tr[i].style.display = "";
                        } else {
                            tr[i].style.display = "none";
                        }
                    }
                }
            }
        </script>
    </head>

    <body>
        <form id="filterParams">
            <b>Suche: </b>
            <input type="text" class="fieldIn" id="filterInput" onkeyup="filtFunction()" placeholder="Gericht eingeben..." style="width: 165px">
            <input type="reset" class="button" id="filterClear" onclick="clearFunction()" value="Clear Filter">
        </form>

        <script>
            //Filter Based on Field and Value Entered
            function filtFunction() {
                tabelle.tabulator("setFilter", fieldSelect.value, "like", filterInput.value); //update Table
            }

            //Clear the filters and display original table
            function clearFunction() {
                tabelle.tabulator("clearFilter");
            }
        </script>
        <div id="tabelle" class="tabelle"></div>
        <p></p>
        <div id="alerts"></div>
        <p></p>
        <div id="buttons" style="text-align: center; border: 1px solid transparent">
            <button id="button-insert-row" class="btn-add" type="button">Neues Gericht hinzufügen</button>
            <button id="button-delete-rows" class="btn-delete" type="button">Markiertes Gericht löschen</button>
            <button id="button-discard-changes" class="btn-discard" type="button">Änderungen verwerfen</button>
            <button id="button-save-changes" class="btn-save" type="button">Änderungen sichern</button>
        </div>

        <section id="index" class="hidden">
            <div class="right">
                <div class="item">
                    <p></p>
                    <p></p>
                    <a href="./index.html" data-navigo>
                        Zurück zur Startseite
                    </a>
                </div>
            </div>
        </section>
    </body>

    </html>
